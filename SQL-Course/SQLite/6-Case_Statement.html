<h1>CASE Statements</h1>
<h3>5.1 Categorizing Wind Speed</h3>
<p>You can use a <code>CASE</code> statement to turn a column value into another value based on conditions. For instance, we can turn different <code>wind_speed</code> ranges into <code>HIGH</code>, <code>MODERATE</code>, and <code>LOW</code> categories.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span>report_code,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">day</span>,<span style="color: #bbbbbb"> </span>wind_speed,

<span style="color: #008800; font-weight: bold">CASE</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">40</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;HIGH&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">30</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;MODERATE&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;LOW&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;N/A&#39;</span>
<span style="color: #008800; font-weight: bold">END</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>wind_severity

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">ORDER</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">by</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">DESC</span>;
</code></pre></div>

<h3>5.2 More Efficient Way To Categorize Wind Speed</h3>
<p>We can actually omit <code>AND wind_speed &lt; 40</code> from the previous example because each <code>WHEN</code>/<code>THEN</code> is evaluated from top-to-bottom. The first one it finds to be true is the one it will go with, and stop evaluating subsequent conditions.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span>report_code,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">day</span>,<span style="color: #bbbbbb"> </span>wind_speed,

<span style="color: #008800; font-weight: bold">CASE</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">40</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;HIGH&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">30</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;MODERATE&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;LOW&#39;</span>
<span style="color: #008800; font-weight: bold">END</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>wind_severity

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
</code></pre></div>

<h3>5.3 Using CASE with GROUP BY</h3>
<p>We can use <code>GROUP BY</code> in conjunction with a <code>CASE</code> statement to slice data in more ways, such as getting the record count by <code>wind_severity</code>.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span>

<span style="color: #008800; font-weight: bold">CASE</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">40</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;HIGH&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">30</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;MODERATE&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;LOW&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;N/A&#39;</span>
<span style="color: #008800; font-weight: bold">END</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">AS</span><span style="color: #bbbbbb"> </span>wind_severity,
<span style="color: #008800; font-weight: bold">COUNT</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb">  </span><span style="color: #008800; font-weight: bold">AS</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span>wind_severity;
</code></pre></div>

<p>Also, some wind_speed values are NULL, so without an <code>ELSE</code> any records that do not meet a condition will turn out to be NULL. </p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span>

<span style="color: #008800; font-weight: bold">CASE</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">40</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;HIGH&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">30</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;MODERATE&#39;</span>
<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>wind_speed<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;LOW&#39;</span>

<span style="color: #008800; font-weight: bold">END</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">AS</span><span style="color: #bbbbbb"> </span>wind_severity,
<span style="color: #008800; font-weight: bold">COUNT</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb">  </span><span style="color: #008800; font-weight: bold">AS</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span>wind_severity;
</code></pre></div>

<h3>5.4 "Zero/Null" Case Trick</h3>
<p>There is really no way to create multiple aggregations with different conditions unless you know a trick with the <code>CASE</code> statement. If you want to find two total precipitation, with and without tornado precipitations, for each year and month, you have to do separate queries.</p>
<p><strong>Tornado Precipitation</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,
<span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>tornado_precipitation
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">AND</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1990</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<p><strong>Non-Tornado Precipitation</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,
<span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>non_tornado_precipitation
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
<span style="color: #008800; font-weight: bold">AND</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1990</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<p>But you can use a single query using a <code>CASE</code> statement that sets a value to 0 if the condition is not met. That way it will not impact the sum.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,
<span style="color: #008800; font-weight: bold">SUM</span>(<span style="color: #008800; font-weight: bold">CASE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span>precipitation<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">END</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>tornado_precipitation,
<span style="color: #008800; font-weight: bold">SUM</span>(<span style="color: #008800; font-weight: bold">CASE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span>precipitation<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">END</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>non_tornado_precipitation

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1990</span>

<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<p>Many folks who are not aware of the zero/null case trick will resort to derived tables (not covered in this class but covered in <em>Advanced SQL for Data Analysis</em>), which adds an unnecessary amount of effort and mess.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span>t.<span style="color: #008800; font-weight: bold">year</span>,
t.<span style="color: #008800; font-weight: bold">month</span>,
t.tornado_precipitation,
non_t.non_tornado_precipitation

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>(
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>tornado_precipitation
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">AND</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1990</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
)<span style="color: #bbbbbb"> </span>t

<span style="color: #008800; font-weight: bold">INNER</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">JOIN</span>

(<span style="color: #bbbbbb">   </span><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>non_tornado_precipitation
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">AND</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1990</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
)<span style="color: #bbbbbb"> </span>non_t
</code></pre></div>

<h3>5.5 Using Null in a CASE to conditionalize MIN/MAX</h3>
<p>Since <code>NULL</code> is ignored in SUM, MIN, MAX, and other aggregate functions, you can use it in a <code>CASE</code> statement to conditionally control whether or not a value should be included in that aggregation.</p>
<p>For instance, we can split up max precipitation when a tornado was present vs not present.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,
<span style="color: #008800; font-weight: bold">MAX</span>(<span style="color: #008800; font-weight: bold">CASE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">0</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span>precipitation<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">NULL</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">END</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>max_non_tornado_precipitation,
<span style="color: #008800; font-weight: bold">MAX</span>(<span style="color: #008800; font-weight: bold">CASE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span>precipitation<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">ELSE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">NULL</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">END</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>max_tornado_precipitation
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1990</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>
</code></pre></div>

<p><em>Switch to slides for exercise</em></p>
<h3>Exercise 5.1</h3>
<p>SELECT  the report_code, year, quarter, and temperature, where a “quarter” is “Q1”, “Q2”, “Q3”, or “Q4” reflecting months 1-3, 4-6, 7-9, and 10-12 respectively.</p>
<p><strong>ANSWER:</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span>

report_code,
<span style="color: #008800; font-weight: bold">year</span>,

<span style="color: #008800; font-weight: bold">CASE</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">3</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q1&#39;</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">6</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q2&#39;</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">7</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">9</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q3&#39;</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">10</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">12</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q4&#39;</span>
<span style="color: #008800; font-weight: bold">END</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>quarter,

temperature

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>STATION_DATA
</code></pre></div>

<h3>Exercise 5.2</h3>
<p>Get the average temperature by quarter and month, where a “quarter” is “Q1”, “Q2”, “Q3”, or “Q4” reflecting months 1-3, 4-6, 7-9, and 10-12 respectively.</p>
<p><strong>ANSWER</strong></p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span>
<span style="color: #008800; font-weight: bold">year</span>,

<span style="color: #008800; font-weight: bold">CASE</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">3</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q1&#39;</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">4</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">6</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q2&#39;</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">7</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">9</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q3&#39;</span>
<span style="color: #bbbbbb">    </span><span style="color: #008800; font-weight: bold">WHEN</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BETWEEN</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">10</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">and</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">12</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">THEN</span><span style="color: #bbbbbb"> </span><span style="background-color: #fff0f0">&#39;Q4&#39;</span>
<span style="color: #008800; font-weight: bold">END</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>quarter,

<span style="color: #008800; font-weight: bold">AVG</span>(temperature)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>avg_temp

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>STATION_DATA
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>,<span style="color: #0000DD; font-weight: bold">2</span>
</code></pre></div>