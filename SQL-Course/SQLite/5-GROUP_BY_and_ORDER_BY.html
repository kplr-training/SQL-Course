<h1>4.GROUP BY and ORDER BY</h1>
<h3>4.1: Getting a count of records</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
</code></pre></div>

<h3>4.2 Getting a count of records with a condition</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tornado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>

<h3>4.3 Getting a count by year</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tornado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span>
</code></pre></div>

<h3>4.4 Getting a count by year, month</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tornado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span>
</code></pre></div>

<h3>4.5 Getting a count by year, month with ordinal index</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tornado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
</code></pre></div>

<h3>4.6 Using ORDER BY</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tornado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span>
</code></pre></div>

<h3>4.7 Using ORDER BY with DESC</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">record_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">tornado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">month</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="k">month</span>
</code></pre></div>

<h3>4.8 Counting non-null values</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">snow_depth</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">recorded_snow_depth_count</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
</code></pre></div>

<h3>4.9 Average temperature by month since year 2000</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_temp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2000</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">month</span>
</code></pre></div>

<h3>4.10 Average temperature (with rounding) by month since year 2000</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_temp</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2000</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">month</span>
</code></pre></div>

<h3>4.11 Sum of snow depth</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">snow_depth</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_snow</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2005</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span>
</code></pre></div>

<h3>4.12 Multiple aggregations</h3>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">snow_depth</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_snow</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">precipitation</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_precipitation</span><span class="p">,</span>
<span class="k">MAX</span><span class="p">(</span><span class="n">precipitation</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">max_precipitation</span>

<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2005</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span>
</code></pre></div>

<h3>EXERCISES</h3>
<p>Flip to slides</p>
<h3>4.13 Using HAVING</h3>
<p>You cannot use WHERE on aggregations. This will result in an error.</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">precipitation</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_precipitation</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">total_precipitation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span>
</code></pre></div>

<p>You can however, use HAVING.</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">year</span><span class="p">,</span>
<span class="k">SUM</span><span class="p">(</span><span class="n">precipitation</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_precipitation</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span>
<span class="k">HAVING</span><span class="w"> </span><span class="n">total_precipitation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span>
</code></pre></div>

<h3>4.14 Getting Distinct values</h3>
<p>You can get DISTINCT values for one or more columns</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">station_number</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
</code></pre></div>

<p>You can also get distinct combinations of values for multiple columns</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">station_number</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">station_data</span>
</code></pre></div>