<h1>4.GROUP BY and ORDER BY</h1>
<h3>4.1: Getting a count of records</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
</code></pre></div>

<h3>4.2 Getting a count of records with a condition</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
</code></pre></div>

<h3>4.3 Getting a count by year</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>
</code></pre></div>

<h3>4.4 Getting a count by year, month</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<h3>4.5 Getting a count by year, month with ordinal index</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>,<span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">2</span>
</code></pre></div>

<h3>4.6 Using ORDER BY</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
<span style="color: #008800; font-weight: bold">ORDER</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<h3>4.7 Using ORDER BY with DESC</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">count</span>(<span style="color: #333333">*</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>record_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>tornado<span style="color: #bbbbbb"> </span><span style="color: #333333">=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">1</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
<span style="color: #008800; font-weight: bold">ORDER</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">DESC</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<h3>4.8 Counting non-null values</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">COUNT</span>(snow_depth)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>recorded_snow_depth_count
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
</code></pre></div>

<h3>4.9 Average temperature by month since year 2000</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">AVG</span>(temperature)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>avg_temp
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">2000</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<h3>4.10 Average temperature (with rounding) by month since year 2000</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>,<span style="color: #bbbbbb"> </span>round(<span style="color: #008800; font-weight: bold">AVG</span>(temperature),<span style="color: #0000DD; font-weight: bold">2</span>)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>avg_temp
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">2000</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">month</span>
</code></pre></div>

<h3>4.11 Sum of snow depth</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">SUM</span>(snow_depth)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>total_snow
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">2005</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>
</code></pre></div>

<h3>4.12 Multiple aggregations</h3>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,
<span style="color: #008800; font-weight: bold">SUM</span>(snow_depth)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>total_snow,
<span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>total_precipitation,
<span style="color: #008800; font-weight: bold">MAX</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>max_precipitation

<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;=</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">2005</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>
</code></pre></div>

<h3>EXERCISES</h3>
<p>Flip to slides</p>
<h3>4.13 Using HAVING</h3>
<p>You cannot use WHERE on aggregations. This will result in an error.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,
<span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>total_precipitation
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">WHERE</span><span style="color: #bbbbbb"> </span>total_precipitation<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">30</span>
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>
</code></pre></div>

<p>You can however, use HAVING.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>,
<span style="color: #008800; font-weight: bold">SUM</span>(precipitation)<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">as</span><span style="color: #bbbbbb"> </span>total_precipitation
<span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
<span style="color: #008800; font-weight: bold">GROUP</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">BY</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span>
<span style="color: #008800; font-weight: bold">HAVING</span><span style="color: #bbbbbb"> </span>total_precipitation<span style="color: #bbbbbb"> </span><span style="color: #333333">&gt;</span><span style="color: #bbbbbb"> </span><span style="color: #0000DD; font-weight: bold">30</span>
</code></pre></div>

<h3>4.14 Getting Distinct values</h3>
<p>You can get DISTINCT values for one or more columns</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">DISTINCT</span><span style="color: #bbbbbb"> </span>station_number<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
</code></pre></div>

<p>You can also get distinct combinations of values for multiple columns</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%;"><span></span><code><span style="color: #008800; font-weight: bold">SELECT</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">DISTINCT</span><span style="color: #bbbbbb"> </span>station_number,<span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">year</span><span style="color: #bbbbbb"> </span><span style="color: #008800; font-weight: bold">FROM</span><span style="color: #bbbbbb"> </span>station_data
</code></pre></div>